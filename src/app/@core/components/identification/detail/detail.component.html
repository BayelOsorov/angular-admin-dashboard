<nb-alert *ngIf="error" class="sticky-alert slideInDown" status="danger"
    ><div class="my-alert">
        <div class="alert-text">
            <i class="nb-info"></i>
            <p>{{ error }}</p>
        </div>

        <button ghost nbButton (click)="closeAlert()">X</button>
    </div>
</nb-alert>
<div class="detail-info">
    <div class="status">
        <strong>{{
            data.status === 'VideoIdentificationProcess'
                ? (data.videoIdentificationRequestedAt
                  | date : 'dd.MM.yyyy, HH:mm')
                : (data.createdAt | date : 'dd.MM.yyyy, HH:mm')
        }}</strong>

        <strong>+{{ data.phoneNumber }}</strong>
        <strong>{{ customerInfo.culture.toUpperCase() }}</strong>

        <nb-alert status="primary">{{
            data.status === 'VideoIdentificationProcess'
                ? 'Видеоидентификация '
                : 'Фотоидентификация'
        }}</nb-alert>
    </div>
    <div class="detail-block mt-4">
        <div class="row">
            <div class="first col-md-6">
                <p class="mx-auto">{{ data.pin }}</p>
                <ngx-identification-need-to-edit
                    *ngIf="data.status === 'PhotoIdentificationProcess'"
                    [data]="identificationAnswers.pin"
                    [control]="form.get('Pin')"
                    placeholder="Введите"
                >
                </ngx-identification-need-to-edit>
                <p class="mx-auto mt-4">
                    {{ data.documentType + ' ' + data.documentNumber }}
                </p>
                <ngx-identification-need-to-edit
                    *ngIf="data.status === 'PhotoIdentificationProcess'"
                    [data]="identificationAnswers.documentNumber"
                    [control]="form.get('DocumentNumber')"
                    placeholder="Введите"
                >
                </ngx-identification-need-to-edit>
            </div>
            <div class="second col-md-6">
                <nb-alert
                    *ngIf="!personalData"
                    status="danger"
                    class="danger-alert"
                >
                    <div>
                        <i class="nb-alert"></i>
                        <p>Нет данных для обработки</p>
                    </div>
                </nb-alert>
                <nb-alert
                    *ngIf="personalData"
                    status="success"
                    class="danger-alert"
                >
                    <div>
                        <i class="nb-checkmark-circle"></i>
                        <p>Данные готовы</p>
                    </div>
                </nb-alert>
            </div>
        </div>
        <div class="row mt-5">
            <div class="first col-md-6">
                <ngx-lightbox-img
                    [imgUrl]="data.passportFrontSideImageUrl"
                ></ngx-lightbox-img>
                <ngx-identification-need-to-edit
                    *ngIf="data.status === 'PhotoIdentificationProcess'"
                    [data]="identificationAnswers.passportFrontSideImage"
                    [control]="form.get('PassportFrontSideImageId')"
                    placeholder="Введите"
                >
                </ngx-identification-need-to-edit>
            </div>
            <div *ngIf="personalData" class="second col-md-6">
                <table class="w-100">
                    <tr>
                        <td>Имя</td>
                        <td>{{ personalData.name }}</td>
                    </tr>
                    <tr>
                        <td>Фамилия</td>
                        <td>{{ personalData.surname }}</td>
                    </tr>
                    <tr>
                        <td>Отчество</td>
                        <td>{{ personalData.patronymic }}</td>
                    </tr>

                    <tr>
                        <td>Дата рождения</td>
                        <td>
                            {{ personalData.birthDate | date : 'dd.MM.yyyy' }}
                        </td>
                    </tr>

                    <tr>
                        <td>Срок действия паспорта</td>
                        <td>
                            {{
                                personalData.dateOfExpiry | date : 'dd.MM.yyyy'
                            }}
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <div class="row mt-5">
            <div class="first col-md-6">
                <ngx-lightbox-img
                    [imgUrl]="data.passportBackSideImageUrl"
                ></ngx-lightbox-img>

                <ngx-identification-need-to-edit
                    *ngIf="data.status === 'PhotoIdentificationProcess'"
                    [data]="identificationAnswers.passportBackSideImage"
                    [control]="form.get('PassportBackSideImageId')"
                    placeholder="Введите"
                >
                </ngx-identification-need-to-edit>
            </div>
            <div *ngIf="personalData" class="second col-md-6">
                <table class="w-100">
                    <tr>
                        <td>ПИН</td>
                        <td>{{ personalData.pin }}</td>
                    </tr>
                    <tr>
                        <td>Паспорт</td>
                        <td>
                            {{
                                personalData.passportType +
                                    ' ' +
                                    personalData.documentNumber
                            }}
                        </td>
                    </tr>

                    <tr>
                        <td>Кем выдан</td>
                        <td>{{ personalData.authority }}</td>
                    </tr>
                    <tr>
                        <td>Дата выдачи</td>
                        <td>
                            {{ personalData.dateOfIssue | date : 'dd.MM.yyyy' }}
                        </td>
                    </tr>
                    <tr>
                        <td>Пол</td>
                        <td>{{ getGender(personalData.gender) }}</td>
                    </tr>

                    <tr>
                        <td>Семейное положение</td>
                        <td>
                            {{ getMaritalStatus(personalData.maritalStatus) }}
                        </td>
                    </tr>
                    <tr>
                        <td>Адрес прописки</td>
                        <td>
                            {{
                                getResidenceLoc(personalData.residenceRegion) +
                                    ', ' +
                                    personalData.residenceAddress
                            }}
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <div class="row mt-5">
            <div class="first col-md-6">
                <ngx-lightbox-img
                    [imgUrl]="data.selfieWithPassportImageUrl"
                ></ngx-lightbox-img>
                <ngx-identification-need-to-edit
                    *ngIf="data.status === 'PhotoIdentificationProcess'"
                    [data]="identificationAnswers.selfieWithPassportImage"
                    [control]="form.get('SelfieWithPassportImageId')"
                    placeholder="Введите"
                >
                </ngx-identification-need-to-edit>
                <p class="mx-auto mt-4">
                    {{
                        getResidenceLoc(data.address.region) +
                            ', ' +
                            data.address.locality +
                            ', ' +
                            data.address.street
                    }}
                </p>
                <ngx-identification-need-to-edit
                    *ngIf="data.status === 'PhotoIdentificationProcess'"
                    [data]="identificationAnswers.address"
                    [control]="form.get('Address')"
                    placeholder="Введите"
                >
                </ngx-identification-need-to-edit>
            </div>
            <div *ngIf="personalData" class="second col-md-6">
                <ngx-lightbox-img
                    [imgUrl]="personalData.profilePhotoUrl"
                ></ngx-lightbox-img>
            </div>
        </div>
    </div>

    <ngx-comments
        [comments]="data.comments"
        (sendCommentEvent)="sendComment($event)"
        class="detail-block"
    ></ngx-comments>
    <ngx-photo-idn-buttons
        *ngIf="data.status === 'VideoIdentificationProcess'"
        [data]="data"
        [openvidu]="openvidu"
        (editEvent)="suspendVideoIdn()"
        (approveEvent)="approveVideoIdn()"
        (declineEvent)="declineVideoIdn()"
        (sendVideoEvent)="sendVideo($event)"
    ></ngx-photo-idn-buttons>
    <ngx-photo-idn-buttons
        *ngIf="data.status === 'PhotoIdentificationProcess'"
        [data]="data"
        [openvidu]="openvidu"
        (editEvent)="editPhotoIdn()"
        (approveEvent)="approvePhotoIdn()"
        (declineEvent)="declinePhotoIdn()"
    ></ngx-photo-idn-buttons>
    <nb-accordion
        *ngIf="data.videoIdentificationCallFiles.length > 0"
        class="mt-5"
        multi
    >
        <nb-accordion-item (collapsedChange)="collapsedChange($event)">
            <nb-accordion-item-header class="justify-content-center">
                Видео
            </nb-accordion-item-header>
            <nb-accordion-item-body>
                <div class="row mt-3 iden-videos">
                    <video
                        *ngFor="
                            let item of data.videoIdentificationCallFiles;
                            trackBy: trackByFn
                        "
                        controls
                        class="col-6 col-sm-3 mt-2"
                        [src]="item.url | useHttpImgSrc"
                    ></video>
                </div>
            </nb-accordion-item-body>
        </nb-accordion-item>
    </nb-accordion>
    <ngx-openvidu
        #openvidu
        *ngIf="data.status === 'VideoIdentificationProcess'"
        [data]="data"
    ></ngx-openvidu>
</div>
